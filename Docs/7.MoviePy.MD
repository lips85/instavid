# ğŸ“Œ ê¸°ëŠ¥ëª…ì„¸ì„œ 7: ë¹„ë””ì˜¤ í•©ì„± ë° ìµœì¢… í¸ì§‘ (MoviePy í™œìš©)

## ğŸŸ¢ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ëŠ¥ëª…ì„¸ì„œ

### 1. í™”ë©´ ë ˆì´ì•„ì›ƒ ë° ë””ìì¸ ëª…ì„¸

- **í˜ì´ì§€ ìœ„ì¹˜**: `app/dashboard/page.tsx`
- **ì»´í¬ë„ŒíŠ¸ ìœ„ì¹˜**:
  - `components/VideoEditor.tsx` (ë¹„ë””ì˜¤ í•©ì„± ë²„íŠ¼ ë° ìƒíƒœ í‘œì‹œ)
  - `components/ui/button.tsx` (ShadCN `Button` ì»´í¬ë„ŒíŠ¸ - "ë¹„ë””ì˜¤ ìƒì„±" ë²„íŠ¼)
  - `components/ui/progress.tsx` (ShadCN `Progress` ì»´í¬ë„ŒíŠ¸ - ë³€í™˜ ì§„í–‰ë¥  í‘œì‹œ)
  - `components/VideoPreview.tsx` (ShadCN `Card` ì»´í¬ë„ŒíŠ¸ - ìƒì„±ëœ ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸°)

#### ğŸ“ UI êµ¬ì„± ìš”ì†Œ

- **ë¹„ë””ì˜¤ ìƒì„± ë²„íŠ¼ (ShadCN `button.tsx`)**

  - í´ë¦­ ì‹œ FastAPI ì„œë²„ì˜ ë¹„ë””ì˜¤ í•©ì„± API í˜¸ì¶œ
  - ë³€í™˜ì´ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë²„íŠ¼ ë¹„í™œì„±í™”

- **ì§„í–‰ë¥  í‘œì‹œ (ShadCN `progress.tsx`)**

  - ë³€í™˜ ìƒíƒœ ë° ì§„í–‰ë¥  í‘œì‹œ

- **ë¹„ë””ì˜¤ ë¯¸ë¦¬ë³´ê¸° (ShadCN `Card` ì»´í¬ë„ŒíŠ¸)**
  - ë³€í™˜ì´ ì™„ë£Œëœ í›„, ìµœì¢… ë¹„ë””ì˜¤ë¥¼ UIì—ì„œ ì¬ìƒ ê°€ëŠ¥

---

### 2. ì‚¬ìš©ì íë¦„ ë° ìƒí˜¸ì‘ìš©

1. ì‚¬ìš©ìê°€ **ì´ë¯¸ì§€, ì˜¤ë””ì˜¤, ìë§‰, ë°°ê²½ìŒì•…ì„ ì„¤ì •**
2. **"ë¹„ë””ì˜¤ ìƒì„±" ë²„íŠ¼ í´ë¦­**
3. Next.js ì„œë²„ì˜ APIë¥¼ í†µí•´ **FastAPI ë¹„ë””ì˜¤ í•©ì„± API í˜¸ì¶œ**
4. MoviePyë¡œ ë¹„ë””ì˜¤ê°€ ìƒì„±ë˜ë©° ì§„í–‰ ìƒíƒœë¥¼ í‘œì‹œ
5. **ì™„ë£Œëœ ë¹„ë””ì˜¤ë¥¼ ë¯¸ë¦¬ë³´ê¸° ë° ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥**

---

### 3. API ì—°ë™

- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ **Next.js Route Handler API**ë¥¼ í˜¸ì¶œí•˜ì—¬ **ë¹„ë””ì˜¤ í•©ì„± ìš”ì²­**
- API ìš”ì²­ ì‹œ, `.env` íŒŒì¼ì—ì„œ FastAPI ì„œë²„ URLì„ ë¶ˆëŸ¬ì˜´

#### ğŸ“ API ìš”ì²­ í˜•ì‹ (í”„ë¡ íŠ¸ì—”ë“œ â†’ Next.js Route Handler)

```ts
const generateVideo = async () => {
  const response = await fetch("/api/generate-video", {
    method: "POST",
  });

  const data = await response.json();
  return data.videoUrl;
};


4. í…ŒìŠ¤íŠ¸ í•­ëª©
âœ… ì‚¬ìš©ìê°€ ì„ íƒí•œ ì´ë¯¸ì§€, ì˜¤ë””ì˜¤, ìë§‰, ë°°ê²½ìŒì•…ì´ ì •ìƒì ìœ¼ë¡œ APIì— ì „ë‹¬ë˜ëŠ”ê°€?
âœ… FastAPI ì„œë²„ì—ì„œ ë¹„ë””ì˜¤ í•©ì„±ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ê°€?
âœ… API ìš”ì²­ í›„ ì§„í–‰ë¥ ì´ UIì— í‘œì‹œë˜ëŠ”ê°€?
âœ… ìµœì¢… ë¹„ë””ì˜¤ë¥¼ ë‹¤ìš´ë¡œë“œ ë° ë¯¸ë¦¬ë³´ê¸°ê°€ ê°€ëŠ¥í•œê°€?

ğŸŸ¢ ë°±ì—”ë“œ ê¸°ëŠ¥ëª…ì„¸ì„œ (FastAPI + MoviePy)
1. API ì •ì˜
íŒŒì¼ ê²½ë¡œ: backend/routes/video_generation.py
ì‚¬ìš© ê¸°ìˆ : FastAPI + MoviePy
í™˜ê²½ ë³€ìˆ˜:
.env íŒŒì¼ì—ì„œ S3 ë²„í‚· ì •ë³´ (AWS_S3_BUCKET_NAME, AWS_S3_REGION) ì‚¬ìš©
IAM ì‚¬ìš©ìì˜ AWS_ACCESS_KEY_ID ë° AWS_SECRET_ACCESS_KEY í•„ìš”
ğŸ“ API ì—”ë“œí¬ì¸íŠ¸
ë©”ì„œë“œ	URL	ì„¤ëª…
POST	/generate-video	MoviePyë¡œ ë¹„ë””ì˜¤ë¥¼ í•©ì„±í•˜ê³  S3ì— ì €ì¥
2. ìš”ì²­ & ì‘ë‹µ êµ¬ì¡°
ğŸ“ ìš”ì²­ (Request)

{
  "images": [
    "https://instavid-storage.s3.us-east-2.amazonaws.com/images/image_1.png",
    "https://instavid-storage.s3.us-east-2.amazonaws.com/images/image_2.png"
  ],
  "audio": "https://instavid-storage.s3.us-east-2.amazonaws.com/audio/narration.mp3",
  "subtitles": [
    { "text": "This is an ancient mystery.", "start": 0, "end": 6 },
    { "text": "Scientists are still trying to understand it.", "start": 6, "end": 12 }
  ],
  "background_music": "https://instavid-storage.s3.us-east-2.amazonaws.com/background/music.mp3"
}


{
  "videoUrl": "https://instavid-storage.s3.us-east-2.amazonaws.com/videos/final_video.mp4"
}

3. API êµ¬í˜„ ë¡œì§
ì´ë¯¸ì§€ & ì˜¤ë””ì˜¤ ë‹¤ìš´ë¡œë“œ

ìš”ì²­ëœ ì´ë¯¸ì§€, ë‚´ë ˆì´ì…˜ ì˜¤ë””ì˜¤, ë°°ê²½ìŒì•…ì„ S3ì—ì„œ ë‹¤ìš´ë¡œë“œ
MoviePyë¥¼ í™œìš©í•œ ë¹„ë””ì˜¤ í•©ì„±

ì´ë¯¸ì§€ & ìë§‰ ì¶”ê°€
ë°°ê²½ìŒì•…ê³¼ ë‚´ë ˆì´ì…˜ ì˜¤ë””ì˜¤ ì‹±í¬ ì¡°ì •
6ì´ˆ ë‹¨ìœ„ë¡œ ì´ë¯¸ì§€ ë³€ê²½
íƒ€ì´í‹€ ë° ì¢…ë£Œ í¬ë ˆë”§ ì¶”ê°€
ì™„ì„±ëœ ë¹„ë””ì˜¤ë¥¼ S3ì— ì—…ë¡œë“œ í›„ URL ë°˜í™˜

ğŸ“ API ë‚´ë¶€ ì²˜ë¦¬ íë¦„ (backend/routes/video_generation.py)
python
Copy
Edit
from fastapi import APIRouter, HTTPException
import os
import requests
import boto3
import moviepy.editor as mp
from dotenv import load_dotenv

load_dotenv()

router = APIRouter()

S3_BUCKET_NAME = os.getenv("AWS_S3_BUCKET_NAME")
S3_REGION = os.getenv("AWS_S3_REGION")
s3 = boto3.client("s3",
                  aws_access_key_id=os.getenv("AWS_ACCESS_KEY_ID"),
                  aws_secret_access_key=os.getenv("AWS_SECRET_ACCESS_KEY"),
                  region_name=S3_REGION)

@router.post("/generate-video")
async def generate_video(request: dict):
    try:
        images = request["images"]
        audio_url = request["audio"]
        background_music_url = request["background_music"]
        subtitles = request["subtitles"]

        # ì´ë¯¸ì§€ ë° ì˜¤ë””ì˜¤ ë‹¤ìš´ë¡œë“œ
        downloaded_images = [mp.ImageClip(requests.get(img).content, duration=6) for img in images]
        narration_audio = mp.AudioFileClip(requests.get(audio_url).content)
        background_music = mp.AudioFileClip(requests.get(background_music_url).content)

        # ì´ë¯¸ì§€ ì‹œí€€ìŠ¤ ìƒì„±
        video = mp.concatenate_videoclips(downloaded_images, method="compose")

        # ì˜¤ë””ì˜¤ í•©ì„±
        video = video.set_audio(mp.CompositeAudioClip([narration_audio, background_music.volumex(0.3)]))

        # ìë§‰ ì¶”ê°€
        for sub in subtitles:
            txt_clip = mp.TextClip(sub["text"], fontsize=24, color="white")
            txt_clip = txt_clip.set_position("bottom").set_duration(sub["end"] - sub["start"])
            video = mp.CompositeVideoClip([video, txt_clip])

        # ìµœì¢… ë¹„ë””ì˜¤ ì €ì¥
        output_path = "final_video.mp4"
        video.write_videofile(output_path, fps=24, codec="libx264")

        # S3 ì—…ë¡œë“œ
        s3.upload_file(output_path, S3_BUCKET_NAME, f"videos/{output_path}")

        video_url = f"https://{S3_BUCKET_NAME}.s3.{S3_REGION}.amazonaws.com/videos/{output_path}"
        return {"videoUrl": video_url}

    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```
